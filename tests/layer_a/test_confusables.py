from core.layer_a.confusables import detect_confusables, script_distribution

# Comprehensive test cases covering all script types and edge cases generated by AI
samples = {
    # 1. Pure Script Types (Legitimate cases)
    "pure_latin": "password",                          # Pure Latin script
    "pure_cyrillic": "Ð¿Ð°Ñ€Ð¾Ð»ÑŒ",                        # Pure Cyrillic (Russian "password")
    "pure_greek": "ÎºÏ‰Î´Î¹ÎºÏŒÏ‚",                          # Pure Greek ("password")
    "pure_arabic": "ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±",                       # Pure Arabic ("password")
    "pure_han": "å¯†ç ",                                # Pure Chinese Han characters ("password")
    "pure_other": "123456!@#",                        # Numbers and symbols (Other)
    
    # 2. Mixed Scripts (Suspicious cases)
    "latin_cyrillic_mixed": "Ñ€Ð°ssword",               # Cyrillic 'Ñ€' + Latin 'assword'
    "latin_greek_mixed": "ÏÎ±ssword",                  # Greek 'ÏÎ±' + Latin 'ssword'
    "latin_arabic_mixed": "pasØ³word",                 # Latin + Arabic 'Ø³'
    "latin_han_mixed": "passå¯†word",                   # Latin + Chinese character
    "multiple_scripts": "Ñ€Ð°sså¯†Ï‰rd",                   # Multiple scripts mixed
    
    # 3. Homoglyph Attacks (Dangerous confusables)
    "cyrillic_homoglyph": "Ñ€assword",                 # Cyrillic 'Ñ€' looks like Latin 'p'
    "greek_homoglyph": "Ïassword",                    # Greek 'Ï' looks like Latin 'p'
    "fullwidth_attack": "ï½assword",                  # Fullwidth 'ï½' looks like Latin 'p'
    "mathematical_attack": "ð©assword",               # Mathematical bold 'p'
    "multiple_homoglyphs": "Ñ€Î±Ñ•Ñ•wÎ¿rd",                # Multiple homoglyphs
    
    # 4. Real-world mixed legitimate cases
    "name_with_accents": "JosÃ© MarÃ­a",                # Legitimate accented characters
    "multilingual_greeting": "Hello Ù…Ø±Ø­Ø¨Ø§",           # English + Arabic greeting
    "code_with_greek": "Ï€ = 3.14159",                # Mathematical symbols
    "email_mixed": "user@Ð´Ð¾Ð¼ÐµÐ½.Ñ€Ñ„",                   # Mixed script domains
    
    # 5. Edge cases
    "empty_string": "",                               # Empty input
    "whitespace_only": "   \t\n  ",                  # Only whitespace
    "numbers_symbols": "123!@#$%^&*()",              # Only numbers and symbols
    "single_char_latin": "a",                        # Single Latin character
    "single_char_cyrillic": "Ð°",                     # Single Cyrillic character (looks like 'a')
    
    # 6. Advanced obfuscation attempts
    "scattered_homoglyphs": "Ð°dmÑ–n pÐ°nÐµl",           # Multiple scattered Cyrillic chars
    "invisible_chars": "pass\u200bword",             # Zero-width space
    "rtl_override": "admin\u202eresU",               # Right-to-left override
    "combining_chars": "paÌ§sÌ¨sÌ¨woÌ§rÌ§dÌ¨",               # Combining diacritical marks
    
    # 7. Long text samples
    "long_pure_latin": "This is a long sentence with only Latin characters for testing purposes.",
    "long_mixed_scripts": "This sentence Ð½Ð°Ñ‡Ð¸Ð½Ð°ÐµÑ‚ÑÑ Ð½Ð° English Ð½Ð¾ ends Ð½Ð° Ñ€ÑƒÑÑÐºÐ¾Ð¼ ÑÐ·Ñ‹ÐºÐµ.",
    "long_homoglyph_attack": "ThÑ–s sentence looks normÐ°l but contÐ°Ñ–ns mÐ°ny homoglÑƒph chÐ°rÐ°cters.",
}

#This test has been improved for better readability and functionality using AI
def test_confusables():
    """Simple confusables test with minimal output"""
    print("CONFUSABLES DETECTION TEST")
    print("=" * 50)
    
    for test_name, text in samples.items():
        result = detect_confusables(text, expected_script="Latin", threshold=0.1)
        
        # Simple one-line summary
        status = "ðŸ”´" if result['is_dangerous'] else "ðŸŸ¡" if result['suspicious'] else "ðŸŸ¢"
        scripts = list(result['script_counts'].keys()) if result['script_counts'] else ['None']
        
        print(f"{status} {test_name:25} | {repr(text[:30]):35} | Scripts: {', '.join(scripts[:3])}")
    
    print("=" * 50)
    print("ðŸ”´ = Dangerous | ðŸŸ¡ = Suspicious | ðŸŸ¢ = Safe")

def test_script_distribution():
    """Simple script distribution test"""
    print("\nSCRIPT DISTRIBUTION TEST")
    print("=" * 50)
    
    for test_name, text in samples.items():
        dist = script_distribution(text)
        total = sum(dist.values()) if dist else 0
        
        # Format script distribution as percentages
        if total > 0:
            script_summary = []
            for script, count in dist.items():
                pct = (count/total)*100
                script_summary.append(f"{script}:{pct:.0f}%")
            script_str = ", ".join(script_summary)
        else:
            script_str = "Empty"
        
        print(f"{test_name:25} | {repr(text[:30]):35} | {script_str}")

# def run_simple_tests():
#     """Run simple test functions"""
#     test_confusables()
#     test_script_distribution() 
#     test_by_category()

# if __name__ == "__main__":
#     run_simple_tests()